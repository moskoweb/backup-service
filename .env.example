# =============================================================================
# CONFIGURAÇÃO DO PERCONA BACKUP R2 PACKAGE
# =============================================================================
# Este arquivo contém todas as variáveis de ambiente necessárias para o
# funcionamento dos scripts de backup, restore e cleanup do MySQL usando
# Percona Xtrabackup e armazenamento no Cloudflare R2.
# =============================================================================

# =============================================================================
# CONFIGURAÇÃO DO S3/CLOUDFLARE R2
# =============================================================================
# Credenciais e configurações para acesso ao Cloudflare R2 (compatível com S3)

# Chave de acesso do R2 (obtenha no painel do Cloudflare)
S3_ACCESS_KEY=your_access_key

# Chave secreta do R2 (obtenha no painel do Cloudflare)
S3_SECRET_KEY=your_secret_key

# Nome do bucket R2 onde os backups serão armazenados
S3_BUCKET=your_bucket

# Endpoint do R2 (substitua your-account-id pelo ID da sua conta Cloudflare)
S3_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com

# Pasta dentro do bucket onde os backups serão organizados
S3_FOLDER=DB-Backup

# =============================================================================
# CONFIGURAÇÃO DO BANCO DE DADOS MYSQL
# =============================================================================
# Configurações de conexão e localização dos dados do MySQL

# Endereço do servidor MySQL (localhost para servidor local)
DB_HOST=127.0.0.1

# Porta do MySQL (padrão: 3306)
DB_PORT=3306

# Usuário do MySQL com privilégios de backup (recomendado: usuário específico)
DB_USER=root

# Senha do usuário MySQL
DB_PASS=secret

# Diretório onde estão armazenados os dados do MySQL
# Ubuntu/Debian: /var/lib/mysql
# CentOS/RHEL: /var/lib/mysql
# macOS (Homebrew): /usr/local/var/mysql
DB_DATA_DIR=/var/lib/mysql

# Nome do banco de dados específico para backup (opcional)
# Se não especificado, fará backup de todos os bancos
# Exemplo: DB_DATABASE=meu_banco_producao
DB_DATABASE=

# Modo de backup: local ou remote
# local: Usa Percona XtraBackup (backup físico, ideal para servidores locais)
# remote: Usa mydumper/myloader (backup lógico, ideal para conexões remotas)
# Padrão: local
BACKUP_MODE=local

# =============================================================================
# CONFIGURAÇÃO DE WEBHOOKS
# =============================================================================
# Sistema de notificações via HTTP para monitoramento dos processos

# URL do webhook para receber notificações (opcional)
# Exemplos: Discord, Slack, webhook.site, ou seu próprio endpoint
WEBHOOK_URL=https://webhook.site/your-id

# Eventos que devem disparar webhooks (separados por vírgula)
# Opções: success, error, restore, cleanup
# - success: Backup realizado com sucesso
# - error: Erro durante qualquer processo
# - restore: Restore realizado (sucesso ou erro)
# - cleanup: Limpeza de arquivos antigos
WEBHOOK_EVENTS=success,error,restore,cleanup

# =============================================================================
# CONFIGURAÇÕES DE BACKUP
# =============================================================================
# Parâmetros para controle dos backups e armazenamento temporário

# Diretório temporário para processamento dos backups
# Certifique-se de que há espaço suficiente (pelo menos 2x o tamanho do banco)
TMP_BACKUP_PATH=/tmp/mysql_backups

# Número de dias para retenção dos backups (arquivos mais antigos serão removidos)
# Recomendado: 30 dias para produção, 7 dias para desenvolvimento
RETENTION_DAYS=30

# =============================================================================
# CONFIGURAÇÕES AVANÇADAS (OPCIONAIS)
# =============================================================================
# Configurações adicionais para personalização do comportamento

# Nível de compressão para os arquivos tar.gz (1-9, padrão: 6)
# 1 = mais rápido, menos compressão
# 9 = mais lento, maior compressão
COMPRESSION_LEVEL=6

# Timeout para operações de upload/download em segundos (padrão: 300 = 5 minutos)
TRANSFER_TIMEOUT=300

# Prefixo para nomes dos arquivos de backup (opcional)
# Útil para identificar backups de diferentes ambientes
BACKUP_PREFIX=

# =============================================================================
# EXEMPLOS DE CONFIGURAÇÃO PARA DIFERENTES CENÁRIOS
# =============================================================================
#
# BACKUP COMPLETO LOCAL (padrão):
# BACKUP_MODE=local
# DB_DATABASE=
# Resultado: Backup completo usando Percona XtraBackup
#
# BACKUP REMOTO DE TODOS OS BANCOS:
# BACKUP_MODE=remote
# DB_DATABASE=
# Resultado: Backup completo usando mydumper (ideal para conexões remotas)
#
# BACKUP LOCAL DE UM BANCO ESPECÍFICO:
# BACKUP_MODE=local
# DB_DATABASE=loja_online
# Resultado: Backup do banco "loja_online" usando XtraBackup
#
# BACKUP REMOTO DE UM BANCO ESPECÍFICO:
# BACKUP_MODE=remote
# DB_DATABASE=loja_online
# Resultado: Backup do banco "loja_online" usando mydumper
#
# CONFIGURAÇÃO POR AMBIENTE:
#
# DESENVOLVIMENTO (local):
# BACKUP_MODE=local
# RETENTION_DAYS=7
# BACKUP_PREFIX=dev-
# TMP_BACKUP_PATH=/tmp/dev_backups
# DB_DATABASE=app_dev
#
# PRODUÇÃO (local):
# BACKUP_MODE=local
# RETENTION_DAYS=30
# BACKUP_PREFIX=prod-
# TMP_BACKUP_PATH=/var/backups/mysql
# DB_DATABASE=app_prod
#
# STAGING (remoto):
# BACKUP_MODE=remote
# RETENTION_DAYS=14
# BACKUP_PREFIX=staging-
# TMP_BACKUP_PATH=/tmp/staging_backups
# DB_DATABASE=app_staging
#
# BACKUP REMOTO PARA ANÁLISE:
# BACKUP_MODE=remote
# DB_DATABASE=analytics
# BACKUP_PREFIX=relatorios-
#
# =============================================================================

# =============================================================================
# DIFERENÇAS ENTRE MÉTODOS DE BACKUP
# =============================================================================
# 
# PERCONA XTRABACKUP (BACKUP_MODE=local):
# - Backup físico (copia arquivos de dados diretamente)
# - Backup completo sempre
# - Mais rápido para grandes volumes de dados
# - Backup consistente sem bloquear o banco
# - Ideal para servidores locais ou conexões de alta velocidade
# - Requer acesso direto aos arquivos de dados do MySQL
#
# MYDUMPER/MYLOADER (BACKUP_MODE=remote):
# - Backup lógico multi-threaded (gera comandos SQL)
# - Backup completo sempre
# - Mais eficiente que mysqldump tradicional
# - Ideal para conexões remotas ou backup seletivo
# - Funciona através de conexão MySQL padrão
# - Melhor compressão e paralelização
#
# =============================================================================
# NOTAS IMPORTANTES
# =============================================================================
# 1. Mantenha este arquivo seguro e não o commite em repositórios públicos
# 2. Certifique-se de que o usuário que executa os scripts tem permissões adequadas
# 3. Teste sempre em ambiente de desenvolvimento antes de usar em produção
# 4. Monitore o espaço em disco do diretório temporário
# 5. Configure alertas para os webhooks para monitoramento proativo
# 6. Para modo local: certifique-se de que o Percona XtraBackup está instalado
# 7. Para modo remoto: certifique-se de que o mydumper/myloader está instalado
# 8. Modo remoto é ideal para conexões lentas ou backup através de rede
# =============================================================================